# Base directory
$baseDir = "C:\tools\dotnet"

# Create base directory if it doesn't exist
if (-not (Test-Path $baseDir)) {
    New-Item -Path $baseDir -ItemType Directory -Force | Out-Null
}

# Download URLs
$dnSpy32Url = "https://github.com/dnSpyEx/dnSpy/releases/download/v6.4.0/dnSpy-net-win32.zip"
$dnSpy64Url = "https://github.com/dnSpyEx/dnSpy/releases/download/v6.4.0/dnSpy-net-win64.zip"
$de4dotUrl  = "https://github.com/ViRb3/de4dot-cex/releases/download/v4.0.0/de4dot-cex.zip"

# Local ZIP paths
$dnSpy32Zip = "$baseDir\dnSpy32.zip"
$dnSpy64Zip = "$baseDir\dnSpy64.zip"
$de4dotZip  = "$baseDir\de4dot-cex.zip"

# Extraction directories
$dnSpy32Folder = "$baseDir\dnSpy_32bit"
$dnSpy64Folder = "$baseDir\dnSpy_64bit"
$de4dotFolder  = "$baseDir\de4dot-cex"

# Download files
Invoke-WebRequest -Uri $dnSpy32Url -OutFile $dnSpy32Zip
Invoke-WebRequest -Uri $dnSpy64Url -OutFile $dnSpy64Zip
Invoke-WebRequest -Uri $de4dotUrl  -OutFile $de4dotZip

# Extract archives
Expand-Archive -Path $dnSpy32Zip -DestinationPath $dnSpy32Folder -Force
Expand-Archive -Path $dnSpy64Zip -DestinationPath $dnSpy64Folder -Force
Expand-Archive -Path $de4dotZip  -DestinationPath $de4dotFolder  -Force

# Delete ZIP files
Remove-Item $dnSpy32Zip, $dnSpy64Zip, $de4dotZip -Force

Write-Host "`n? All tools downloaded, extracted, and ZIPs deleted from $baseDir"
