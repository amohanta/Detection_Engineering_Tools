# URLs for Python installers
$pythonX64Url = "https://www.python.org/ftp/python/3.8.0/python-3.8.0-amd64.exe"
$pythonX86Url = "https://www.python.org/ftp/python/3.8.0/python-3.8.0.exe"

# Local temp paths for installers
$pythonX64Installer = "$env:TEMP\python-3.8.0-amd64.exe"
$pythonX86Installer = "$env:TEMP\python-3.8.0.exe"

# Target installation directories
$installDirX64 = "C:\python-3.8-x64"
$installDirX86 = "C:\python-3.8-x86"

# Download installers
Invoke-WebRequest -Uri $pythonX64Url -OutFile $pythonX64Installer
Invoke-WebRequest -Uri $pythonX86Url -OutFile $pythonX86Installer

# Install x64 Python
Start-Process -FilePath $pythonX64Installer -ArgumentList "/quiet InstallAllUsers=1 TargetDir=`"$installDirX64`" Include_test=0" -Wait

# Install x86 Python
Start-Process -FilePath $pythonX86Installer -ArgumentList "/quiet InstallAllUsers=1 TargetDir=`"$installDirX86`" Include_test=0" -Wait

# Function to add folder to system PATH
function Add-ToSystemPath {
    param (
        [string]$NewPath
    )

    $currentPath = [Environment]::GetEnvironmentVariable("Path", [EnvironmentVariableTarget]::Machine)
    if ($currentPath -notlike "*$NewPath*") {
        $newPathValue = "$currentPath;$NewPath"
        [Environment]::SetEnvironmentVariable("Path", $newPathValue, [EnvironmentVariableTarget]::Machine)
        Write-Host "Added $NewPath to system PATH"
    } else {
        Write-Host "$NewPath already exists in PATH"
    }
}

# Add both Python install paths and their Scripts folders to PATH
Add-ToSystemPath "$installDirX64"
Add-ToSystemPath "$installDirX64\Scripts"
Add-ToSystemPath "$installDirX86"
Add-ToSystemPath "$installDirX86\Scripts"

# Refresh environment PATH for current session
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine")

Write-Host "`n? Installation complete. You may need to restart PowerShell or log off/log on for PATH changes to fully apply."
